!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).JcampConverter={})}(this,(function(t){"use strict";const e=["TIC",".RIC","SCANNUMBER"];function n(t){let n=t.spectra,r=n.length,l={times:new Array(r),series:{ms:{dimension:2,data:new Array(r)}}},i=[];for(let t=0;t<e.length;t++){let s=a(e[t]);n[0][s]&&(i.push(s),l.series[s]={dimension:1,data:new Array(r)})}for(let t=0;t<r;t++){let e=n[t];l.times[t]=e.pageValue;for(let n=0;n<i.length;n++)l.series[i[n]].data[t]=parseFloat(e[i[n]]);e.data&&(l.series.ms.data[t]=[e.data.x,e.data.y])}t.chromatogram=l}function r(t){return-1!==e.indexOf(t)}function a(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"")}function l(t){let e=[];for(let n=0;n<t.length;n++)e.push(parseFloat(t[n]));return e}function i(t,e){let n=t.yFactor,r=t.deltaX;t.isXYdata=!0;let a={x:[],y:[]};t.data=a;let l,i=t.firstX,s=t.firstY,o=!1,f=0;for(;f<e.length;f++)if(l=e.charCodeAt(f),13===l||10===l)o=!0;else if(o)break;let u=!0,p=!1,c=!1,h=0,d=!1,g=!1,m=0,v=0,y=!1,b=!1,A=!1,x=0;for(;f<=e.length;f++)if(l=f===e.length?13:e.charCodeAt(f),g)13!==l&&10!==l||(u=!0,g=!1);else if(l<=57&&l>=48)b=!0,x>0?m+=(l-48)/Math.pow(10,x++):(m*=10,m+=l-48);else if(44===l||46===l)b=!0,x++;else{if(b){if(u)u=!1,c&&(A=!0);else if(A)A=!1;else{p?(h=y?0-m:m,c=!0,p=!1):d||(v=y?0-m:m);let t=d?m-1:1;for(let e=0;e<t;e++)c?s+=h:s=v,a.x.push(i),a.y.push(s*n),i+=r}y=!1,m=0,x=0,b=!1,d=!1}if(l<74&&l>63)b=!0,c=!1,m=l-64;else if(l>96&&l<106)b=!0,c=!1,m=l-96,y=!0;else if(115===l)b=!0,d=!0,m=9;else if(l>82&&l<91)b=!0,d=!0,m=l-82;else if(l>73&&l<83)b=!0,p=!0,m=l-73;else if(l>105&&l<115)b=!0,p=!0,m=l-105,y=!0;else if(36===l&&36===e.charCodeAt(f+1))b=!0,g=!0;else if(37===l)b=!0,p=!0,m=0,y=!1;else if(45===l){let t=e.charCodeAt(f+1);(t>=48&&t<=57||44===t||46===t)&&(b=!0,u||(c=!1),y=!0)}else 13!==l&&10!==l||(u=!0,g=!1)}}const s=/\$\$.*/,o=/[,\t ]+/;function f(t,e,n){if(t.isPeaktable=!0,t.variables&&2!==Object.keys(t.variables)?function(t,e,n){let r={},a=Object.keys(t.variables),l=a.length;a.forEach(t=>r[t]=[]),t.data=r;let i=e.split(/,? *,?[;\r\n]+ */);for(let t=1;t<i.length;t++){let e=i[t].trim().replace(s,"").split(o);if(e.length%l==0)for(let t=0;t<e.length;t++)r[a[t%l]].push(parseFloat(e[t]));else n.logs.push("Format error: "+e)}}(t,e,n):function(t,e,n){let r={x:[],y:[]};t.data=r;let a=e.split(/,? *,?[;\r\n]+ */);for(let e=1;e<a.length;e++){let l=a[e].trim().replace(s,"").split(o);if(l.length%2==0)for(let e=0;e<l.length;e+=2)r.x.push(parseFloat(l[e])*t.xFactor),r.y.push(parseFloat(l[e+1])*t.yFactor);else n.logs.push("Format error: "+l)}}(t,e,n),t.variables)for(let e in t.variables)t.variables[e].data=t.data[e]}function u(t,e){let n,r=/(\(+|\)+|<+|>+|\s+)/g;t.isXYAdata=!0;let a={x:[],y:[]};t.data=a;let l=e.split(/,? *,?[;\r\n]+ */);for(let t=1;t<l.length;t++)n=l[t].trim().replace(r,"").split(","),a.x.push(parseFloat(n[0])),a.y.push(parseFloat(n[1]))}const p=Object.prototype.toString;var c=function(t){return p.call(t).endsWith("Array]")},h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function d(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}var g=d((function(t){!function(){function e(t){for(var e=0,a=t.length-1,l=void 0,i=void 0,s=void 0,o=r(e,a);;){if(a<=e)return t[o];if(a==e+1)return t[e]>t[a]&&n(t,e,a),t[o];for(t[l=r(e,a)]>t[a]&&n(t,l,a),t[e]>t[a]&&n(t,e,a),t[l]>t[e]&&n(t,l,e),n(t,l,e+1),i=e+1,s=a;;){do{i++}while(t[e]>t[i]);do{s--}while(t[s]>t[e]);if(s<i)break;n(t,i,s)}n(t,e,s),s<=o&&(e=i),s>=o&&(a=s-1)}}var n=function(t,e,n){var r;return r=[t[n],t[e]],t[e]=r[0],t[n]=r[1],r},r=function(t,e){return~~((t+e)/2)};t.exports?t.exports=e:window.median=e}()}));function m(t){if(!c(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");return g(t.slice())}function v(t,e){let n=function(t){let e=t[0].data.y[0],n=e,r=t.length,a=t[0].data.x.length,l=new Array(r);for(let i=0;i<r;i++){l[i]=t[i].data.y;for(let t=0;t<a;t++){let r=l[i][t];r<e&&(e=r),r>n&&(n=r)}}const i=t[0].data.x[0],s=t[0].data.x[t[0].data.x.length-1],o=t[0].pageValue,f=t[r-1].pageValue;if(i>s)for(let t of l)t.reverse();return o>f&&l.reverse(),{z:l,minX:Math.min(i,s),maxX:Math.max(i,s),minY:Math.min(o,f),maxY:Math.max(o,f),minZ:e,maxZ:n,noise:m(l[0].map(Math.abs))}}(t.spectra);e.noContour||(t.contourLines=function(t,e){let n,r,a,l,i,s,o,f,u,p,c,h,d,g=t.noise,m=t.z,v=m.length,y=m[0].length,b=t.minX,A=(t.maxX-b)/(y-1),x=t.minY,w=(t.maxY-x)/(v-1),F=t.minZ,T=t.maxZ,M=2*e.nbContourLevels,X=new Array(M);for(let t=0;t<M;t++){let M={};X[t]=M;let N=t%2,E=(T-e.noiseMultiplier*g)*Math.exp((t>>1)-e.nbContourLevels);d=0===N?E+e.noiseMultiplier*g:0-E-e.noiseMultiplier*g;let S=[];if(M.zValue=d,M.lines=S,!(d<=F||d>=T))for(let t=0;t<v-1;t++){let e=m[t],g=m[t+1];for(let m=0;m<y-1;m++)n=e[m],r=e[m+1],a=g[m],l=g[m+1],i=n>d,s=r>d,o=a>d,f=l>d,i!==s&&i!==o&&(u=m+(d-n)/(r-n),p=t,c=m,h=t+(d-n)/(a-n),S.push(u*A+b),S.push(p*w+x),S.push(c*A+b),S.push(h*w+x)),f!==s&&f!==o&&(u=m+1,p=t+1-(d-l)/(r-l),c=m+1-(d-l)/(a-l),h=t+1,S.push(u*A+b),S.push(p*w+x),S.push(c*A+b),S.push(h*w+x)),s!==o&&(u=(m+1-(d-r)/(a-r))*A+b,p=(t+(d-r)/(a-r))*w+x,s!==i&&(c=m+1-(d-r)/(n-r),h=t,S.push(u),S.push(p),S.push(c*A+b),S.push(h*w+x)),o!==i&&(c=m,h=t+1-(d-a)/(n-a),S.push(u),S.push(p),S.push(c*A+b),S.push(h*w+x)),s!==f&&(c=m+1,h=t+(d-r)/(l-r),S.push(u),S.push(p),S.push(c*A+b),S.push(h*w+x)),o!==f&&(c=m+(d-a)/(l-a),h=t+1,S.push(u),S.push(p),S.push(c*A+b),S.push(h*w+x)))}}return{minX:t.minX,maxX:t.maxX,minY:t.minY,maxY:t.maxY,segments:X}}(n,e),delete n.z),t.minMax=n}d((function(t,e){!function(t){function e(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function n(t){return 1===t.length&&(t=r(t)),{left:function(e,n,r,a){for(null==r&&(r=0),null==a&&(a=e.length);r<a;){var l=r+a>>>1;t(e[l],n)<0?r=l+1:a=l}return r},right:function(e,n,r,a){for(null==r&&(r=0),null==a&&(a=e.length);r<a;){var l=r+a>>>1;t(e[l],n)>0?a=l:r=l+1}return r}}}function r(t){return function(n,r){return e(t(n),r)}}var a=n(e),l=a.right,i=a.left;function s(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function o(t){return null===t?NaN:+t}function f(t,e){var n,r,a=t.length,l=0,i=0,s=-1,f=0;if(null==e)for(;++s<a;)isNaN(n=o(t[s]))||(i+=(r=n-l)*(n-(l+=r/++f)));else for(;++s<a;)isNaN(n=o(e(t[s],s,t)))||(i+=(r=n-l)*(n-(l+=r/++f)));if(f>1)return i/(f-1)}function u(t,e){var n=f(t,e);return n?Math.sqrt(n):n}function p(t,e){var n,r,a,l=-1,i=t.length;if(null==e){for(;++l<i;)if(null!=(r=t[l])&&r>=r){n=a=r;break}for(;++l<i;)null!=(r=t[l])&&(n>r&&(n=r),a<r&&(a=r))}else{for(;++l<i;)if(null!=(r=e(t[l],l,t))&&r>=r){n=a=r;break}for(;++l<i;)null!=(r=e(t[l],l,t))&&(n>r&&(n=r),a<r&&(a=r))}return[n,a]}function c(t){return function(){return t}}function h(t){return t}function d(t,e,n){t=+t,e=+e,n=(a=arguments.length)<2?(e=t,t=0,1):a<3?1:+n;for(var r=-1,a=0|Math.max(0,Math.ceil((e-t)/n)),l=new Array(a);++r<a;)l[r]=t+r*n;return l}var g=Math.sqrt(50),m=Math.sqrt(10),v=Math.sqrt(2);function y(t,e,n){var r=b(t,e,n);return d(Math.ceil(t/r)*r,Math.floor(e/r)*r+r/2,r)}function b(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),a=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),l=r/a;return l>=g?a*=10:l>=m?a*=5:l>=v&&(a*=2),e<t?-a:a}function A(t){return Math.ceil(Math.log(t.length)/Math.LN2)+1}function x(t){return+t}function w(){var t=h,e=p,n=A;function r(r){var a,i,s=r.length,o=new Array(s);for(a=0;a<s;++a)o[a]=+t(r[a],a,r);var f=e(o),u=+f[0],p=+f[1],c=n(o,u,p);Array.isArray(c)||(c=y(u,p,+c));var h=c.length;for(a=0;a<h;++a)c[a]=+c[a];for(;c[0]<=u;)c.shift(),--h;for(;c[h-1]>=p;)c.pop(),--h;var d,g=new Array(h+1);for(a=0;a<=h;++a)(d=g[a]=[]).x0=a>0?c[a-1]:u,d.x1=a<h?c[a]:p;for(a=0;a<s;++a)u<=(i=o[a])&&i<=p&&g[l(c,i,0,h)].push(r[a]);return g}return r.value=function(e){return arguments.length?(t="function"==typeof e?e:c(+e),r):t},r.domain=function(t){return arguments.length?(e="function"==typeof t?t:c([+t[0],+t[1]]),r):e},r.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:Array.isArray(t)?c(Array.prototype.map.call(t,x)):c(+t),r):n},r}function F(t,e,n){if(null==n&&(n=o),r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,a=(r-1)*e,l=Math.floor(a),i=+n(t[l],l,t);return i+(+n(t[l+1],l+1,t)-i)*(a-l)}}function T(t,n,r){return t.sort(e),Math.ceil((r-n)/(2*(F(t,.75)-F(t,.25))*Math.pow(t.length,-1/3)))}function M(t,e,n){return Math.ceil((n-e)/(3.5*u(t)*Math.pow(t.length,-1/3)))}function X(t,e){var n,r,a=-1,l=t.length;if(null==e){for(;++a<l;)if(null!=(r=t[a])&&r>=r){n=r;break}for(;++a<l;)null!=(r=t[a])&&r>n&&(n=r)}else{for(;++a<l;)if(null!=(r=e(t[a],a,t))&&r>=r){n=r;break}for(;++a<l;)null!=(r=e(t[a],a,t))&&r>n&&(n=r)}return n}function N(t,e){var n,r=0,a=t.length,l=-1,i=a;if(null==e)for(;++l<a;)isNaN(n=o(t[l]))?--i:r+=n;else for(;++l<a;)isNaN(n=o(e(t[l],l,t)))?--i:r+=n;if(i)return r/i}function E(t,n){var r,a=[],l=t.length,i=-1;if(null==n)for(;++i<l;)isNaN(r=o(t[i]))||a.push(r);else for(;++i<l;)isNaN(r=o(n(t[i],i,t)))||a.push(r);return F(a.sort(e),.5)}function S(t){for(var e,n,r,a=t.length,l=-1,i=0;++l<a;)i+=t[l].length;for(n=new Array(i);--a>=0;)for(e=(r=t[a]).length;--e>=0;)n[--i]=r[e];return n}function O(t,e){var n,r,a=-1,l=t.length;if(null==e){for(;++a<l;)if(null!=(r=t[a])&&r>=r){n=r;break}for(;++a<l;)null!=(r=t[a])&&n>r&&(n=r)}else{for(;++a<l;)if(null!=(r=e(t[a],a,t))&&r>=r){n=r;break}for(;++a<l;)null!=(r=e(t[a],a,t))&&n>r&&(n=r)}return n}function Y(t){for(var e=0,n=t.length-1,r=t[0],a=new Array(n<0?0:n);e<n;)a[e]=[r,r=t[++e]];return a}function C(t,e){for(var n=e.length,r=new Array(n);n--;)r[n]=t[e[n]];return r}function L(t,n){if(r=t.length){var r,a,l=0,i=0,s=t[i];for(n||(n=e);++l<r;)(n(a=t[l],s)<0||0!==n(s,s))&&(s=a,i=l);return 0===n(s,s)?i:void 0}}function P(t,e,n){for(var r,a,l=(null==n?t.length:n)-(e=null==e?0:+e);l;)a=Math.random()*l--|0,r=t[l+e],t[l+e]=t[a+e],t[a+e]=r;return t}function R(t,e){var n,r=0,a=t.length,l=-1;if(null==e)for(;++l<a;)(n=+t[l])&&(r+=n);else for(;++l<a;)(n=+e(t[l],l,t))&&(r+=n);return r}function D(t){if(!(a=t.length))return[];for(var e=-1,n=O(t,U),r=new Array(n);++e<n;)for(var a,l=-1,i=r[e]=new Array(a);++l<a;)i[l]=t[l][e];return r}function U(t){return t.length}function k(){return D(arguments)}var I="0.7.1";t.version=I,t.bisect=l,t.bisectRight=l,t.bisectLeft=i,t.ascending=e,t.bisector=n,t.descending=s,t.deviation=u,t.extent=p,t.histogram=w,t.thresholdFreedmanDiaconis=T,t.thresholdScott=M,t.thresholdSturges=A,t.max=X,t.mean=N,t.median=E,t.merge=S,t.min=O,t.pairs=Y,t.permute=C,t.quantile=F,t.range=d,t.scan=L,t.shuffle=P,t.sum=R,t.ticks=y,t.tickStep=b,t.transpose=D,t.variance=f,t.zip=k}(e)})),d((function(t,e){(function(){var t,n="0.3.0",r="2013-03";(t=e).toString=function(){return"version "+n+", released "+r};for(var a=0,l=null,i=null,s={init:function(t){if(0===t||0!=(t&t-1))throw new Error("init: radix-2 required");a=t,s._initArray(),s._makeBitReversalTable(),s._makeCosSinTable()},fft1d:function(t,e){s.fft(t,e,1)},ifft1d:function(t,e){var n=1/a;s.fft(t,e,-1);for(var r=0;r<a;r++)t[r]*=n,e[r]*=n},bt1d:function(t,e){s.fft(t,e,-1)},fft2d:function(t,e){for(var n=[],r=[],l=0,i=0;i<a;i++){l=i*a;for(var o=0;o<a;o++)n[o]=t[o+l],r[o]=e[o+l];s.fft1d(n,r);for(var f=0;f<a;f++)t[f+l]=n[f],e[f+l]=r[f]}for(var u=0;u<a;u++){for(var p=0;p<a;p++)l=u+p*a,n[p]=t[l],r[p]=e[l];s.fft1d(n,r);for(var c=0;c<a;c++)t[l=u+c*a]=n[c],e[l]=r[c]}},ifft2d:function(t,e){for(var n=[],r=[],l=0,i=0;i<a;i++){l=i*a;for(var o=0;o<a;o++)n[o]=t[o+l],r[o]=e[o+l];s.ifft1d(n,r);for(var f=0;f<a;f++)t[f+l]=n[f],e[f+l]=r[f]}for(var u=0;u<a;u++){for(var p=0;p<a;p++)l=u+p*a,n[p]=t[l],r[p]=e[l];s.ifft1d(n,r);for(var c=0;c<a;c++)t[l=u+c*a]=n[c],e[l]=r[c]}},fft:function(t,e,n){for(var r,s,o,f,u,p,c,h,d,g=a>>2,m=0;m<a;m++)m<(f=l[m])&&(u=t[m],t[m]=t[f],t[f]=u,u=e[m],e[m]=e[f],e[f]=u);for(var v=1;v<a;v<<=1){s=0,r=a/(v<<1);for(var y=0;y<v;y++){p=i[s+g],c=n*i[s];for(var b=y;b<a;b+=v<<1)h=p*t[o=b+v]+c*e[o],d=p*e[o]-c*t[o],t[o]=t[b]-h,t[b]+=h,e[o]=e[b]-d,e[b]+=d;s+=r}}},_initArray:function(){l="undefined"!=typeof Uint32Array?new Uint32Array(a):[],i="undefined"!=typeof Float64Array?new Float64Array(1.25*a):[]},_paddingZero:function(){},_makeBitReversalTable:function(){var t=0,e=0,n=0;for(l[0]=0;++t<a;){for(n=a>>1;n<=e;)e-=n,n>>=1;e+=n,l[t]=e}},_makeCosSinTable:function(){var t=a>>1,e=a>>2,n=a>>3,r=t+e,l=Math.sin(Math.PI/a),s=2*l*l,o=Math.sqrt(s*(2-s)),f=i[e]=1,u=i[0]=0;l=2*s;for(var p=1;p<n;p++)s+=l*(f-=s),o-=l*(u+=o),i[p]=u,i[e-p]=f;0!==n&&(i[n]=Math.sqrt(.5));for(var c=0;c<e;c++)i[t-c]=i[c];for(var h=0;h<r;h++)i[h+t]=-i[h]}},o=["init","fft1d","ifft1d","fft2d","ifft2d"],f=0;f<o.length;f++)t[o[f]]=s[o[f]];return t.bt=s.bt1d,t.fft=s.fft1d,t.ifft=s.ifft1d,t}).call(h)}));const y={"1H":267522187.44,"2H":41065e3,"3H":285350800,"3He":-203789e3,"7Li":103962e3,"13C":67282840,"14N":19331e3,"15N":-27116e3,"17O":-36264e3,"19F":251662e3,"23Na":70761e3,"27Al":69763e3,"29Si":-5319e4,"31P":108291e3,"57Fe":8681e3,"63Cu":71118e3,"67Zn":16767e3,"129Xe":-73997e3};function b(t,e,n){t.profiling&&t.profiling.push({action:e,time:Date.now()-n.start})}function A(t){let e=t.spectra[0].data;t.chromatogram={times:e.x.slice(),series:{intensity:{dimension:1,data:e.y.slice()}}}}function x(t,e,r){!function(t){let e=0,n=0;for(let r of t)for(let t of r.spectra){if(r.ntuples&&r.ntuples.symbol?(!e&&t.observeFrequency&&(e=t.observeFrequency),!n&&t.shiftOffsetVal&&(n=t.shiftOffsetVal)):(e=t.observeFrequency,n=t.shiftOffsetVal),e&&t.xUnits&&t.xUnits.toUpperCase().includes("HZ")){t.xUnits="PPM",t.xFactor=t.xFactor/e,t.firstX=t.firstX/e,t.lastX=t.lastX/e,t.deltaX=t.deltaX/e;for(let n=0;n<t.data.x.length;n++)t.data.x[n]/=e}if(n){let e=t.firstX-n;t.firstX=t.firstX-e,t.lastX=t.lastX-e;for(let n=0;n<t.data.x.length;n++)t.data.x[n]-=e}if(e&&r.ntuples&&r.ntuples.symbol&&r.ntuples.nucleus){let n="",a=r.ntuples.symbol.indexOf(t.pageSymbol);if(r.ntuples.units&&r.ntuples.units[a]&&(n=r.ntuples.units[a]),"PPM"!==n){if(0!==a)throw Error("Not sure about this ntuples format");let n=y[r.ntuples.nucleus[0]],l=y[r.ntuples.nucleus[1]];if(!n||!l)throw Error("Problem with determination of gyromagnetic ratio");let i=n/l*e;t.pageValue/=i}}}}(t);for(let a of t){if(Object.keys(a.ntuples).length>0){let t=[],e=Object.keys(a.ntuples);for(let n=0;n<e.length;n++){let r=e[n],l=a.ntuples[r];for(let e=0;e<l.length;e++)t[e]||(t[e]={}),t[e][r]=l[e]}a.ntuples=t}a.twoD&&r.wantXY&&(v(a,r),b(e,"Finished countour plot calculation",r),r.keepSpectra||delete a.spectra),r.chromatogram&&(a.spectra.length>1?n(a):A(a),b(e,"Finished chromatogram calculation",r))}}function w(t,e,n){let r=-1,a=-1,l="",i="";if(n.indexOf("++")>0)l=n.replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),i=n.replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");else{l=(n=n.replace(/[^a-zA-Z]/g,"")).charAt(0),i=n.charAt(1),e.variables={};for(let r of n){let n=r.toLowerCase(),a=t.ntuples.symbol.indexOf(r);if(-1===a)throw Error("Symbol undefined: "+r);e.variables[n]={};for(let r in t.ntuples)t.ntuples[r][a]&&(e.variables[n][r.replace(/^var/,"")]=t.ntuples[r][a])}}r=t.ntuples.symbol.indexOf(l),a=t.ntuples.symbol.indexOf(i),-1===r&&(r=0),-1===a&&(a=0),t.ntuples.first&&(t.ntuples.first.length>r&&(e.firstX=t.ntuples.first[r]),t.ntuples.first.length>a&&(e.firstY=t.ntuples.first[a])),t.ntuples.last&&(t.ntuples.last.length>r&&(e.lastX=t.ntuples.last[r]),t.ntuples.last.length>a&&(e.lastY=t.ntuples.last[a])),t.ntuples.vardim&&t.ntuples.vardim.length>r&&(e.nbPoints=t.ntuples.vardim[r]),t.ntuples.factor&&(t.ntuples.factor.length>r&&(e.xFactor=t.ntuples.factor[r]),t.ntuples.factor.length>a&&(e.yFactor=t.ntuples.factor[a])),t.ntuples.units&&(t.ntuples.units.length>r&&(t.ntuples.varname&&t.ntuples.varname[r]?e.xUnits=`${t.ntuples.varname[r]} [${t.ntuples.units[r]}]`:e.xUnits=t.ntuples.units[r]),t.ntuples.units.length>a&&(t.ntuples.varname&&t.ntuples.varname[a]?e.yUnits=`${t.ntuples.varname[a]} [${t.ntuples.units[a]}]`:e.yUnits=t.ntuples.units[a]))}function F(t){t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1)}const T=/[ \t]*,[ \t]*/;class M{}const X={keepRecordsRegExp:/^$/,canonicDataLabels:!0,canonicMetadataLabels:!1,dynamicTyping:!0,withoutXY:!1,chromatogram:!1,keepSpectra:!1,noContour:!1,nbContourLevels:7,noiseMultiplier:5,profiling:!1};t.convert=function(t,e={}){(e=Object.assign({},X,e)).wantXY=!e.withoutXY,e.start=Date.now();let n=[],s={profiling:!!e.profiling&&[],logs:[],entries:[]},o={children:[]},p=o,c=[],h=new M;if("string"!=typeof t)throw new TypeError("the JCAMP should be a string");b(s,"Before split to LDRS",e);let d=t.replace(/[\r\n]+##/g,"\n##").split("\n##");b(s,"Split to LDRS",e),d[0]&&(d[0]=d[0].replace(/^[\r\n ]*##/,""));for(let t of d){let o=t.indexOf("="),d=o>0?t.substring(0,o):t,g=o>0?t.substring(o+1).trim():"",m=d.replace(/[_ -]/g,"").toUpperCase();if("DATATABLE"===m){let t=g.indexOf("\n");if(-1===t&&(t=g.indexOf("\r")),t>0){let e=g.substring(0,t).split(/[ ,;\t]+/);w(p,h,e[0]),h.datatable=e[0],e[1]&&e[1].indexOf("PEAKS")>-1?m="PEAKTABLE":e[1]&&(e[1].indexOf("XYDATA")||e[0].indexOf("++")>0)&&(m="XYDATA",h.deltaX=(h.lastX-h.firstX)/(h.nbPoints-1))}}if("XYDATA"!==m)if("PEAKTABLE"!==m)if("PEAKASSIGNMENTS"!==m){if("TITLE"===m){let t=p;t.children||(t.children=[]),p={spectra:[],ntuples:{},info:{},meta:{}},t.children.push(p),c.push(t),n.push(p),p.title=g}else"DATATYPE"===m?(p.dataType=g,g.toLowerCase().indexOf("nd")>-1&&(p.twoD=!0)):"NTUPLES"===m?g.toLowerCase().indexOf("nd")>-1&&(p.twoD=!0):"DATACLASS"===m?p.dataClass=g:"XUNITS"===m?h.xUnits=g:"YUNITS"===m?h.yUnits=g:"FIRSTX"===m?h.firstX=parseFloat(g):"LASTX"===m?h.lastX=parseFloat(g):"FIRSTY"===m?h.firstY=parseFloat(g):"LASTY"===m?h.lastY=parseFloat(g):"NPOINTS"===m?h.nbPoints=parseFloat(g):"XFACTOR"===m?h.xFactor=parseFloat(g):"YFACTOR"===m?h.yFactor=parseFloat(g):"MAXX"===m?h.maxX=parseFloat(g):"MINX"===m?h.minX=parseFloat(g):"MAXY"===m?h.maxY=parseFloat(g):"MINY"===m?h.minY=parseFloat(g):"DELTAX"===m?h.deltaX=parseFloat(g):".OBSERVEFREQUENCY"===m||"$SFO1"===m?h.observeFrequency||(h.observeFrequency=parseFloat(g)):".OBSERVENUCLEUS"===m?h.xType||(p.xType=g.replace(/[^a-zA-Z0-9]/g,"")):"$OFFSET"===m?(p.shiftOffsetNum=0,h.shiftOffsetVal||(h.shiftOffsetVal=parseFloat(g))):"$REFERENCEPOINT"===m||("VARNAME"===m?p.ntuples.varname=g.split(T):"SYMBOL"===m?p.ntuples.symbol=g.split(T):"VARTYPE"===m?p.ntuples.vartype=g.split(T):"VARFORM"===m?p.ntuples.varform=g.split(T):"VARDIM"===m?p.ntuples.vardim=l(g.split(T)):"UNITS"===m?p.ntuples.units=g.split(T):"FACTOR"===m?p.ntuples.factor=l(g.split(T)):"FIRST"===m?p.ntuples.first=l(g.split(T)):"LAST"===m?p.ntuples.last=l(g.split(T)):"MIN"===m?p.ntuples.min=l(g.split(T)):"MAX"===m?p.ntuples.max=l(g.split(T)):".NUCLEUS"===m?(p.ntuples&&(p.ntuples.nucleus=g.split(T)),p.twoD&&(p.yType=g.split(T)[0])):"PAGE"===m?(h.page=g.trim(),h.pageValue=parseFloat(g.replace(/^.*=/,"")),h.pageSymbol=h.page.replace(/[=].*/,"")):"RETENTIONTIME"===m?h.pageValue=parseFloat(g):r(m)?h[a(m)]=g:"SAMPLEDESCRIPTION"===m?h.sampleDescription=g:"END"===m&&(p=c.pop()));if(p&&p.info&&p.meta&&m.match(e.keepRecordsRegExp)){let t,n,r=g.trim();if(d.startsWith("$")?(n=e.canonicMetadataLabels?m.substring(1):d.substring(1),t=p.meta):(n=e.canonicDataLabels?m:d,t=p.info),e.dynamicTyping){let t=Number.parseFloat(r);Number.isNaN(t)||(r=t)}t[n]?(Array.isArray(t[n])||(t[n]=[t[n]]),t[n].push(r)):t[n]=r}}else e.wantXY&&(g.match(/.*(XYA).*/)&&u(h,g),p.spectra.push(h),h=new M);else e.wantXY&&(F(h),f(h,g,s),p.spectra.push(h),h=new M);else e.wantXY&&(F(h),g.match(/.*\+\+.*/)?(h.deltaX||(h.deltaX=(h.lastX-h.firstX)/(h.nbPoints-1)),i(h,g)):f(h,g,s),p.spectra.push(h),h=new M)}return b(s,"Finished parsing",e),x(n,s,e),b(s,"Total time",e),s.entries=o.children,s.flatten=n,s},t.createTree=function(t,e={}){const{flatten:n=!1}=e;if("string"!=typeof t)throw new TypeError("the JCAMP should be a string");let r,a=t.split(/[\r\n]+/),l=[],i=[],s=[],o=0,f=t.includes("## ");for(let t=0;t<a.length;t++){let e=a[t],n=f?e.replace(/ /g,""):e;if("##NTUPLES"===n.substring(0,9)&&o++,"##TITLE"===n.substring(0,7)){let s=[n.substring(8).trim()];for(let e=t+1;e<a.length&&!a[e].startsWith("##");e++)s.push(a[e].trim());i.push({title:s.join("\n"),jcamp:e+"\n",children:[]}),r=i[i.length-1],l.push(r)}else if("##END"===n.substring(0,5)&&0===o){r.jcamp+=e+"\n";let t=i.pop();0!==i.length?(r=i[i.length-1],r.children.push(t)):(r=void 0,s.push(t))}else if(r&&r.jcamp){r.jcamp+=e+"\n";let t=n.match(/^##(.*?)=(.+)/);if(t){"DATATYPE"===t[1].replace(/[ _-]/g,"").toUpperCase()&&(r.dataType=t[2].trim())}}"##END"===n.substring(0,5)&&o>0&&o--}return n?(l.forEach(t=>{t.children=void 0}),l):s},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=jcampconverter.min.js.map
